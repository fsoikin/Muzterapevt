define(["require","exports","../common","ko","ko.mapping","jQuery","text!./Templates/page.html","css!styles/Page.css"],function(n,t,i,r,u,f,e){var h=i,o=r,c=u,s=f,l={Load:"page/load",Update:"page/update"},v=function(){function n(n){this.ControlsDescendantBinidngs=!0,this.PageId=n.id}return n.prototype.OnLoaded=function(n){var t=this;this.PageElement=s(n),this.PageElement.html()||this.PageElement.text("Right-click here"),this.MenuElement=a.Menu.clone().appendTo("body").hide(),o.applyBindings(this,this.MenuElement[0]),this.PageElement.click(function(n){if(n.which==3){t.MenuElement.css({top:n.pageY,left:n.pageY}).fadeIn(100);s(document).one("click",function(){return t.MenuElement.fadeOut(100)});return!1}})},n.prototype.OnEdit=function(){var n=this.Editor||(this.Editor=new y(this));n.Show()},n}(),y=function(){function n(n){var t=this;this.Page=n,this.IsLoading=o.observable(!1),this.Error=o.observable(),this.Text=o.observable(""),this.Title=o.observable(""),h.Api.Get(l.Load,n.PageId,this.IsLoading,this.Error,function(n){return c.fromJS(n,{},t)})}return n.prototype.Save=function(){var t=this,n=c.toJS(this);n.Id=this.Page.PageId,h.Api.Post(l.Update,n,this.IsLoading,this.Error,function(){return t.Close()})},n.prototype.Cancel=function(){this.Close()},n.prototype.Close=function(){this.Element&&this.Element.fadeOut()},n.prototype.Show=function(){var n=this.Element||(this.Element=a.Editor.clone().appendTo("body"));n.fadeIn()},n}(),p=e,a=function(){var n=s(p);return{Menu:n.filter(".page-menu"),Editor:n.filter(".page-editor")}}();return v})