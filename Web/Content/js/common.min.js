define(["require","exports","rx","ko","./Base/api","./Base/seq"],function(n,t,i,r,u,f){function a(n,t){return n[t]}function v(n){var r=[],i,t;for(i in n)t=parseInt(i),t===null||t===undefined||isNaN(t)||r.push({Name:n[i],Value:t});return r}function y(n){return{Items:e.observable(t.mapEnum(n)),GetId:function(n){return n.Value},ToString:function(n){return n.Name}}}function p(n){var t=e.observable();return setImmediate(function(){return t(n)}),{Items:t,GetId:function(n){return n.Value},ToString:function(n){return n.Name}}}function w(n,t,i){return function(){return new o({url:n,getId:i||function(n){return n.Id},toString:t||function(n){return n.Name}})}}function b(n,t,i){if(typeof i=="undefined"&&(i=function(n,t){return n==t}),!n)return!t;if(!t||n.length!=t.length)return!1;for(var r=0;r<n.length;r++)if(!i(n[r],t[r]))return!1;return!0}function k(n){return e.computed({read:function(){return new Date(n())},write:function(t){return n(t&&t.toJSON())}})}function d(n){return e.computed({read:function(){return n().toJSON()},write:function(t){return n(new Date(t))}})}function g(n,t){function i(){this.constructor=n,n.call(this,t)}return i.prototype=n.prototype,i}var c=i,e=r,l=u,s,h,o;t._api=l,s=f,t._seq=s,t.Seq=t._seq,t.Api=t._api,t.enumToString=a,t.mapEnum=v,t.dataSourceFromEnum=y,t.dataSourceFromNameValuePair=p,t.dataSourceFromServer=w,h=function(){function n(){this.IsLoading=e.observable(!1),this.IsSaving=e.observable(!1),this.Message=new e.subscribable,this.Error=new e.subscribable}return n}(),t.VmBase=h,o=function(){function n(n){this.IsLoading=e.observable(!1),this.Error=new e.subscribable,this.Items=e.observableArray();var t=this;t.GetId=n.getId||function(n){if(!n)return null;if(!("Id"in n))throw new Error("'Id' property not found on object "+JSON.stringify(n));return n.Id},t.ToString=n.toString||function(n){return(n||"").toString()},this.Url=n.url,this.LookupUrl=n.lookupUrl,this.Reload()}return n.prototype.GetId=function(){return null},n.prototype.ToString=function(){return""},n.prototype.Reload=function(){t.Api.Get(this.Url,null,this.IsLoading,this.Error,this.Items)},n.prototype.Lookup=function(n){var i=this;return this.LookupUrl?c.Observable.create(function(r){var u=new e.subscribable,f=u.subscribe(function(n){r.onError(n);i.Error.notifySubscribers(n)}),o=t.Api.Get(i.LookupUrl(n),null,i.IsLoading,u,function(n){r.onNext(n);r.onCompleted()});return function(){f.dispose(),o.abort()}}):(n=(n||"").toLowerCase(),this.Items.asRx().select(function(t){return t.filter(function(t){var r=i.ToString(t);return r&&r.toLowerCase().indexOf(n)>=0})}).take(1))},n.prototype.GetById=function(n){var t=this.Items();return t&&e.utils.arrayFirst(t,function(t){return t.Id==n})},n}(),t.RemoteDataSource=o,t.compareArrays=b,t.koStringToDate=k,t.koDateToString=d,t.bindClass=g})