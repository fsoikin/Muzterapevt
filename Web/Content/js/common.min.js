define(["require","exports","rx","ko","jQuery","./Base/api","./Base/seq"],function(n,t,i,r,u,f,e){function y(n,t){return n[t]}function p(n){var r=[],i,t;for(i in n)t=parseInt(i),t===null||t===undefined||isNaN(t)||r.push({Name:n[i],Value:t});return r}function w(n){return{Items:o.observable(t.mapEnum(n)),GetId:function(n){return n.Value},ToString:function(n){return n.Name}}}function b(n){var t=o.observable();return setImmediate(function(){return t(n)}),{Items:t,GetId:function(n){return n.Value},ToString:function(n){return n.Name}}}function k(n,t,i){return function(){return new s({url:n,getId:i||function(n){return n.Id},toString:t||function(n){return n.Name}})}}function d(n,t,i){if(typeof i=="undefined"&&(i=function(n,t){return n==t}),!n)return!t;if(!t||n.length!=t.length)return!1;for(var r=0;r<n.length;r++)if(!i(n[r],t[r]))return!1;return!0}function g(n){return o.computed({read:function(){return new Date(n())},write:function(t){return n(t&&t.toJSON())}})}function nt(n){return o.computed({read:function(){return n().toJSON()},write:function(t){return n(new Date(t))}})}function tt(n,t){function i(){this.constructor=n,n.call(this,t)}return i.prototype=n.prototype,i}function it(n){var t=typeof n=="string"?h(n):n;return function(n){h.makeArray(o.virtualElements.childNodes(n)).every(function(n){return n.nodeType!=1})&&o.virtualElements.setDomNodeChildren(n,t.clone()),o.applyBindingsToDescendants(this,n)}}var a=i,o=r,h=u,v=f,c,l,s;t._api=v,c=e,t._seq=c,t.Seq=t._seq,t.Api=t._api,t.enumToString=y,t.mapEnum=p,t.dataSourceFromEnum=w,t.dataSourceFromNameValuePair=b,t.dataSourceFromServer=k,l=function(){function n(){this.IsLoading=o.observable(!1),this.IsSaving=o.observable(!1),this.Message=new o.subscribable,this.Error=new o.subscribable}return n}(),t.VmBase=l,s=function(){function n(n){this.IsLoading=o.observable(!1),this.Error=new o.subscribable,this.Items=o.observableArray();var t=this;t.GetId=n.getId||function(n){if(!n)return null;if(!("Id"in n))throw new Error("'Id' property not found on object "+JSON.stringify(n));return n.Id},t.ToString=n.toString||function(n){return(n||"").toString()},this.Url=n.url,this.LookupUrl=n.lookupUrl,this.Reload()}return n.prototype.GetId=function(){return null},n.prototype.ToString=function(){return""},n.prototype.Reload=function(){t.Api.Get(this.Url,null,this.IsLoading,this.Error,this.Items)},n.prototype.Lookup=function(n){var i=this;return this.LookupUrl?a.Observable.create(function(r){var u=new o.subscribable,f=u.subscribe(function(n){r.onError(n);i.Error.notifySubscribers(n)}),e=t.Api.Get(i.LookupUrl(n),null,i.IsLoading,u,function(n){r.onNext(n);r.onCompleted()});return function(){f.dispose(),e.abort()}}):(n=(n||"").toLowerCase(),this.Items.asRx().select(function(t){return t.filter(function(t){var r=i.ToString(t);return r&&r.toLowerCase().indexOf(n)>=0})}).take(1))},n.prototype.GetById=function(n){var t=this.Items();return t&&o.utils.arrayFirst(t,function(t){return t.Id==n})},n}(),t.RemoteDataSource=s,t.compareArrays=d,t.koStringToDate=g,t.koDateToString=nt,t.bindClass=tt,t.ApplyTemplate=it})