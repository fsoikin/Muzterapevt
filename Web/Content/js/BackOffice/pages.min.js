var __extends=this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);r.prototype=t.prototype,n.prototype=new r};define(["require","exports","../common","ko","ko.mapping","jQuery","text!./Templates/pages.html"],function(n,t,i,r,u,f,e){var s=i,o=r,h=u,w=f,l={Load:"BackOffice/Pages/All",Update:"BackOffice/Pages/Update",Create:"BackOffice/Pages/Create"},a=function(){function n(){this.Id=0,this.Path=""}return n}(),v,c,y,p;t.Page=a,v=function(n){function t(){var t=this;n.call(this),this.Pages=o.observableArray(),this.OnLoaded=p,this.ControlsDescendantBindings=!0,s.Api.Get(l.Load,null,this.IsLoading,this.Error,function(n){return t.Pages(n.map(function(n){return new c(t,n)}))})}return __extends(t,n),t.prototype.Create=function(){var n=new c(this,null);this.Pages.push(n),n.Edit()},t}(s.VmBase),t.PagesVm=v,c=function(){function n(n,t){var i=this;this.Parent=n,this.Model=t,this.IsNew=o.observable(!0),this.IsSaving=o.observable(!1),this.IsEditing=o.observable(!1),this.Path=o.observable(""),this.Id=o.observable(0),h.fromJS(t||new a,{},this),this.IsNew(!t),this.IsEditing.subscribe(function(n){n&&i.Parent.Pages().forEach(function(n){return n==i||n.IsEditing(!1)})})}return n.prototype.Edit=function(){this.IsEditing(!0)},n.prototype.CommitEdit=function(){var n=this;this.Model=h.toJS(this),s.Api.Post(this.IsNew()?l.Create:l.Update,JSON.stringify(this.Model),this.IsSaving,this.Parent.Error,function(t){h.fromJS(n.Model=t,{},n),n.IsEditing(!1),n.IsNew(!1)})},n.prototype.CancelEdit=function(){this.IsEditing(!1),h.fromJS(this.Model,{},this)},n}(),t.PageVm=c,y=e,p=s.ApplyTemplate(y)})